import{d as J,s as P}from"./pinia@2.3.1_typescript@5.6.3_vue@3.5.13_typescript@5.6.3_-Bbm25ImI.js";import{c as F,p as K}from"./index-B9uzr887.js";import{d as M,X as C,o as p,c as m,i as u,D as _,I as R,a as s,F as B,S as V,E as A,m as q,H,C as Q,n as W}from"./@vue_runtime-core@3.5.13-D0UggR25.js";import{v as h,m as z,q as $,k as X,C as Y,e as T}from"./@vue_reactivity@3.5.13-DVqfZfgJ.js";import{p as O,M as L}from"./@vue_shared@3.5.13-oPavf41m.js";import{a as Z}from"./axios@1.7.9-upsvKRUO.js";import{d as E}from"./@vue_runtime-dom@3.5.13-BVspzEjS.js";import{H as N}from"./highlight.js@11.11.1-C2crdlaO.js";import{M as ee}from"./markdown-it@14.1.0-D5JcBv3I.js";import"./vue-demi@0.14.10_vue@3.5.13_typescript@5.6.3_-Dq6ymT-8.js";import"./@iconify_vue@4.3.0_vue@3.5.13_typescript@5.6.3_-NS46C8hN.js";import"./nprogress@0.2.0-2myQQFUx.js";import"./artplayer@5.2.2-DS9jODRL.js";import"./@vueuse_core@12.5.0_typescript@5.6.3-DxQS7b1s.js";import"./@vueuse_shared@12.5.0_typescript@5.6.3-CYuF3qNP.js";import"./vue-router@4.5.0_vue@3.5.13_typescript@5.6.3_-Ck-ukzwP.js";import"./element-plus@2.9.3_vue@3.5.13_typescript@5.6.3_-cDIutw2K.js";import"./lodash-es@4.17.21-C-zDejYo.js";import"./@vueuse_shared@9.13.0_vue@3.5.13_typescript@5.6.3_-C-4_69NP.js";import"./@vueuse_core@9.13.0_vue@3.5.13_typescript@5.6.3_-CSKvZi15.js";import"./@element-plus_icons-vue@2.3.1_vue@3.5.13_typescript@5.6.3_-DA6ZXMEE.js";import"./@sxzz_popperjs-es@2.11.7-D9SI2xQl.js";import"./@ctrl_tinycolor@3.6.1-r5W6hzzQ.js";import"./dayjs@1.11.13-B9vLV8e8.js";import"./async-validator@4.2.5-9PlIezaS.js";import"./memoize-one@6.0.0-BdPwpGay.js";import"./normalize-wheel-es@1.2.0-B6fDCfyv.js";import"./@floating-ui_dom@1.6.13-CajCCXHK.js";import"./@floating-ui_core@1.6.9-B4d9L5V3.js";import"./@floating-ui_utils@0.2.9-CfPjaTyQ.js";import"./vue-i18n@11.0.1_vue@3.5.13_typescript@5.6.3_-DcD3Ohgl.js";import"./@intlify_core-base@11.0.1-BZLI_61R.js";import"./@intlify_shared@11.0.1-i7e918a7.js";import"./@intlify_message-compiler@11.0.1-CJM0b8Rk.js";import"./pinia-plugin-persistedstate@4.2.0_pinia@2.3.1_typescript@5.6.3_vue@3.5.13_typescript@5.6.3___rollup@4.29.1-_Zka_ujQ.js";import"./destr@2.0.3-CVtkxrq9.js";import"./deep-pick-omit@1.2.1-CegYQlcN.js";import"./mdurl@2.0.0-k9Sl0PQj.js";import"./uc.micro@2.1.0-kMc2yuuw.js";import"./entities@4.5.0-C20TfXL6.js";import"./linkify-it@5.0.0-znNeQGaU.js";import"./punycode.js@2.3.1-Dj65hjkv.js";const te="/static/png/Ellipse%2043@3x-Drc6nnGS.png",j=J({id:"chatStore",state:()=>({apiBaseUrl:"https://api.chatanywhere.tech",apiToken:"",conversations:F,activeConversationId:0,modelSelect:"gpt-3.5-turbo"}),actions:{setChatState(...r){this.$patch({[r[0]]:r[1]})},addConversation(){const r={id:this.conversations.length+1,messages:[]};this.conversations.push(r),this.activeConversationId=this.conversations.length-1},deleteConversation(r){const o=this.conversations.findIndex(e=>e.id===r);o!==-1&&(this.conversations.splice(o,1),this.activeConversationId=Math.max(0,this.activeConversationId-1))},createMessage(r,o,e){const c=e!==void 0?e:this.activeConversationId,l=this.conversations[c];if(l){const i=l.messages;if(o==="system")if(i.length>0&&i[i.length-1].role==="system")i[i.length-1].content+=r;else{const d={role:"system",content:r};l.messages.push(d)}else{const d={role:"user",content:r};l.messages.push(d)}}}},persist:K("ChatStore")}),oe={class:"w-64 text-foreground p-4 overflow-hidden border-r"},se={class:"overflow-y-auto overflow-x-hidden"},ne=["onClick"],ae={class:"w-full"},re={class:"font-bold"},le={class:"text-sm text-muted-foreground line-clamp-1"},ie=M({__name:"left",emits:["change"],setup(r,{emit:o}){const e=j(),{conversations:c,activeConversationId:l}=P(e),i=o;function d(g){e.setChatState("activeConversationId",g),i("change")}return(g,t)=>{const w=C("el-button");return p(),m("aside",oe,[u(w,{type:"primary",onClick:t[0]||(t[0]=f=>h(e).addConversation()),class:"my-4 w-full"},{default:_(()=>t[1]||(t[1]=[R(" 新增会话 ")])),_:1}),s("ul",se,[(p(!0),m(B,null,V(h(c),(f,y)=>{var n;return p(),m("li",{class:O(["mb-2 p-2 cursor-pointer flex items-center transition duration-300 hover:bg-hoverMenuBg rounded-lg",{"bg-hoverMenuBg":y===h(l)}]),key:f.id,onClick:v=>d(y)},[t[2]||(t[2]=s("img",{src:te,alt:"Avatar",class:"w-10 h-10 rounded-full mr-2"},null,-1)),s("div",ae,[s("p",re,"会话 "+L(f.id),1),s("p",le,L(((n=f.messages[f.messages.length-1])==null?void 0:n.content)||"暂无消息"),1)])],10,ne)}),128))])])}}}),ce={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function de(r,o){return p(),m("svg",ce,o[0]||(o[0]=[s("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M22.153 3.553L11.176 21.004l-1.67-8.596L2 7.898zM9.456 12.444l12.696-8.89"},null,-1)]))}const pe=z({name:"iconoir-send-diagonal",render:de}),me="/static/png/Ellipse%2037@3x-GIA0Qrbh.png",ue="/static/png/Ellipse%2042@3x-BDK8lf_o.png",he={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function fe(r,o){return p(),m("svg",he,o[0]||(o[0]=[s("g",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"},[s("path",{d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 0 0 2.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 0 0 1.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 0 0-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 0 0-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 0 0-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 0 0-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 0 0 1.066-2.573c-.94-1.543.826-3.31 2.37-2.37c1 .608 2.296.07 2.572-1.065"}),s("path",{d:"M9 12a3 3 0 1 0 6 0a3 3 0 0 0-6 0"})],-1)]))}const ge=z({name:"tabler-settings",render:fe}),ve={class:"mb-4"},_e={class:"mb-4"},ye={class:"flex items-center gap-4 justify-end"},ke=M({__name:"settingDialog",setup(r){const o=j(),e=$(!1),c=X({apiBaseUrl:o.apiBaseUrl,apiToken:o.apiToken}),{apiBaseUrl:l,apiToken:i}=Y(c);function d(){o.setChatState("apiBaseUrl",l.value),o.setChatState("apiToken",i.value),e.value=!1}return(g,t)=>{const w=ge,f=C("el-button"),y=C("el-dialog");return p(),m(B,null,[u(f,{class:"h-full",type:"primary",onClick:t[0]||(t[0]=n=>e.value=!0)},{default:_(()=>[u(w)]),_:1}),u(y,{modelValue:h(e),"onUpdate:modelValue":t[4]||(t[4]=n=>T(e)?e.value=n:null),"show-close":!0,width:"500",title:"API 设置"},{footer:_(()=>[s("div",ye,[u(f,{onClick:t[3]||(t[3]=n=>e.value=!1)},{default:_(()=>t[7]||(t[7]=[R("取消")])),_:1}),u(f,{type:"primary",onClick:d},{default:_(()=>t[8]||(t[8]=[R("保存")])),_:1})])]),default:_(()=>[s("div",ve,[t[5]||(t[5]=s("label",{for:"api-base-url",class:"block text-sm font-medium text-gray-700"},"API 基地址",-1)),A(s("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=n=>T(l)?l.value=n:null),class:"mt-1 p-2 block w-full border rounded-lg bg-transparent",placeholder:"https://api.example.com"},null,512),[[E,h(l)]])]),s("div",_e,[t[6]||(t[6]=s("label",{for:"api-key",class:"block text-sm font-medium text-gray-700"},"API Key",-1)),A(s("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=n=>T(i)?i.value=n:null),class:"mt-1 p-2 block w-full border rounded-lg bg-transparent",placeholder:"your-api-key-here"},null,512),[[E,h(i)]])])]),_:1},8,["modelValue"])],64)}}}),xe=r=>{const o=new ee({highlight:(c,l)=>{const i='<button class="copy-code-btn absolute top-2 right-2" onclick="copyCode(this)">复制代码</button>';if(l&&N.getLanguage(l))try{const d=N.highlight(c,{language:l,ignoreIllegals:!0}).value;return`<pre class="hljs"><code>${i}${d}</code></pre>`}catch{return`<pre class="hljs"><code>${o.utils.escapeHtml(c)}</code></pre>`}return`<pre class="hljs"><code>${o.utils.escapeHtml(c)}</code></pre>`}});let e=o.render(r);return e=e.replace(/<a\s+([^>]*\s+)?href="([^"]*\.m3u8)"\s*([^>]*)>/g,'<a $1href="#/video?videoUrl=$2&videoType=application/x-mpegURL" $3>'),e.replace(/<a /g,'<a target="_blank" ')},Ce={class:"flex-1 p-4 flex flex-col text-foreground"},be={key:0,src:me,alt:"ChatGPT Avatar",class:"w-10 h-10 rounded-full mr-2"},we={class:"p-4 rounded-xl bg-background text-sm shadow-lg max-w-[80%]"},$e=["innerHTML"],Te={key:1,src:ue,alt:"User Avatar",class:"w-10 h-10 rounded-full ml-2"},Se={class:"mt-4 flex items-center w-full gap-2"},Be={class:"relative w-full flex items-center"},Me=M({__name:"right",setup(r,{expose:o}){const e=j(),c=$(),{conversations:l,activeConversationId:i,modelSelect:d}=P(e),g=$(""),t=$([]),w=async(n,v)=>{var b,x;try{for(;;){const{done:k,value:I}=await n.read();if(k)break;const S=v.decode(I,{stream:!0}).split(`
`).filter(a=>a.trim());for(const a of S)if(a.startsWith("data: ")){const U=a.substring(6).trim();if(U&&U!=="[DONE]"){const G=((x=(b=JSON.parse(U).choices[0])==null?void 0:b.delta)==null?void 0:x.content)||"";e.createMessage(G,"system"),y()}}}}catch(k){console.error("处理流式数据错误:",k)}};async function f(){var x;if(g.value.trim()==="")return;e.createMessage(g.value,"user"),y();const n=await fetch(`${e.apiBaseUrl}/v1/chat/completions`,{method:"POST",headers:{Authorization:e.apiToken,"Content-Type":"application/json"},body:JSON.stringify({model:d.value,messages:e.conversations[e.activeConversationId].messages,stream:!0})});if(!n.ok){const k=await n.json();throw new Error(`${k.error.code} - ${k.error.message}`)}g.value="";const v=(x=n.body)==null?void 0:x.getReader(),b=new TextDecoder("utf-8");await w(v,b)}const y=()=>{W(()=>{c.value&&(c.value.scrollTop=c.value.scrollHeight)})};return q(async()=>{if(e.apiBaseUrl&&e.apiToken){const{data:n}=await Z.get(`${e.apiBaseUrl}/v1/models`,{headers:{Authorization:e.apiToken}});t.value=n.data}}),o({scrollToBottom:y}),(n,v)=>{var S;const b=C("el-option"),x=C("el-select"),k=C("el-input"),I=pe,D=C("el-button");return p(),m("main",Ce,[s("div",{class:"flex-1 overflow-y-auto",ref_key:"chatRef",ref:c},[(p(!0),m(B,null,V((S=h(l)[h(i)])==null?void 0:S.messages,a=>(p(),m("div",{key:a.content,class:O(["mb-4 flex",{"items-start":a.role==="system","items-end justify-end":a.role!=="system"}])},[a.role==="system"?(p(),m("img",be)):H("",!0),s("div",we,[s("p",{innerHTML:h(xe)(a.content)},null,8,$e)]),a.role!=="system"?(p(),m("img",Te)):H("",!0)],2))),128))],512),s("div",Se,[s("div",Be,[u(k,{placeholder:"Type your message here...",modelValue:h(g),"onUpdate:modelValue":v[1]||(v[1]=a=>T(g)?g.value=a:null)},{append:_(()=>[u(x,{modelValue:h(d),"onUpdate:modelValue":v[0]||(v[0]=a=>T(d)?d.value=a:null),placeholder:"Model",size:"large",style:{width:"215px"}},{default:_(()=>[(p(!0),m(B,null,V(h(t),a=>(p(),Q(b,{key:a.id,label:a.id,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])]),u(D,{class:"h-full",type:"primary",onClick:f},{default:_(()=>[u(I)]),_:1}),u(ke)])])}}}),Ie={class:"flex h-full"},kt=M({__name:"index",setup(r){const o=$();function e(){o.value.scrollToBottom()}return(c,l)=>(p(),m("div",Ie,[u(ie,{onChange:e}),u(Me,{ref_key:"RightRef",ref:o},null,512)]))}});export{kt as default};
